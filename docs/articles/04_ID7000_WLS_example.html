<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>04 ID7000 WLS Example â€¢ AutoSpectral</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="04 ID7000 WLS Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AutoSpectral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01_Full_AutoSpectral_Workflow.html">01 Full Workflow Example</a></li>
    <li><a class="dropdown-item" href="../articles/02_Control_File_example.html">02 Creating the control file</a></li>
    <li><a class="dropdown-item" href="../articles/03_Aurora_example.html">03 Aurora AutoSpectral Example</a></li>
    <li><a class="dropdown-item" href="../articles/04_ID7000_WLS_example.html">04 ID7000 WLS Example</a></li>
    <li><a class="dropdown-item" href="../articles/05_Preparing_Controls.html">05 Preparing Controls</a></li>
    <li><a class="dropdown-item" href="../articles/06_Gating.html">06 Gating</a></li>
    <li><a class="dropdown-item" href="../articles/07_Cleaning.html">07 Control clean-up</a></li>
    <li><a class="dropdown-item" href="../articles/08_Single_Cell_AutoFluorescence.html">08 Single Cell Autofluorescence</a></li>
    <li><a class="dropdown-item" href="../articles/09_Per_Cell_Optimization.html">09 Per Cell Optimization</a></li>
    <li><a class="dropdown-item" href="../articles/10_Reload_AutoSpectral.html">10 Re-running AutoSpectral</a></li>
    <li><a class="dropdown-item" href="../articles/11_Plotting.html">11 Plotting</a></li>
    <li><a class="dropdown-item" href="../articles/12_Speed_It_Up.html">12 Speed It Up (Why So Slow?)</a></li>
    <li><a class="dropdown-item" href="../articles/13_Updates_And_Issues.html">13 Updates and Issues</a></li>
    <li><a class="dropdown-item" href="../articles/14_Development.html">14 Development</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DrCytometer/AutoSpectral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>04 ID7000 WLS Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DrCytometer/AutoSpectral/blob/HEAD/vignettes/articles/04_ID7000_WLS_example.Rmd" class="external-link"><code>vignettes/articles/04_ID7000_WLS_example.Rmd</code></a></small>
      <div class="d-none name"><code>04_ID7000_WLS_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="a-simple-id7000-workflow">A simple ID7000 workflow<a class="anchor" aria-label="anchor" href="#a-simple-id7000-workflow"></a>
</h2>
<p>Below is a basic example of the workflow, using samples from the
ID7000. This only illustrates weighted least squares unmixing. For
per-cell autofluorescence extraction or per-cell fluorophore
optimization, see the articles on those topics. The point of this
workflow is to show how the control clean-up and automated determination
of fluorophore spectra can mimic or improve upon the unmixing obtained
on the Sony using their WLSM unmixing. The workflow here just uses
weighted least squares (WLS) for unmixing.</p>
<p>Please see the <a href="https://drcytometer.github.io/AutoSpectral/articles/01_Full_AutoSpectral_Workflow.html">Full
Workflow</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/DrCytometer/AutoSpectral" class="external-link">AutoSpectral</a></span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the location of the single-stained control files.</span></span>
<span><span class="va">control.dir</span> <span class="op">&lt;-</span> <span class="st">"./Cell controls"</span></span>
<span></span>
<span><span class="co"># Get the parameters for your cytometer.</span></span>
<span><span class="co"># Supported cytometers include "aurora", "id7000", "a8", "s8" and "opteon".</span></span>
<span><span class="va">asp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.autospectral.param.html">get.autospectral.param</a></span><span class="op">(</span> cytometer <span class="op">=</span> <span class="st">"id7000"</span>, figures <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Optionally, create a control file (see article on this).</span></span>
<span><span class="co"># After creating it, manually edit to ensure it is correct.</span></span>
<span><span class="fu"><a href="../reference/create.control.file.html">create.control.file</a></span><span class="op">(</span> <span class="va">control.dir</span>, <span class="va">asp</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Locate the edited control file.</span></span>
<span><span class="va">control.def.file</span> <span class="op">&lt;-</span> <span class="st">"fcs_control_file.csv"</span></span>
<span></span>
<span><span class="co"># check the control file for errors</span></span>
<span><span class="va">control.file.errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check.control.file.html">check.control.file</a></span><span class="op">(</span> <span class="va">control.dir</span>, <span class="va">control.def.file</span>, <span class="va">asp</span> <span class="op">)</span></span>
<span></span>
<span><span class="co">## Adjustments to automated gating</span></span>
<span><span class="co"># This will be covered more extensively elsewhere.</span></span>
<span><span class="co"># in this case, the cells on scatter are very small, so we modify the target.</span></span>
<span><span class="va">asp</span><span class="op">$</span><span class="va">gate.bound.density.max.target.cells</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Load the control files, gate, prepare for spectral extraction.</span></span>
<span><span class="co"># This is usually the slowest step.</span></span>
<span><span class="va">flow.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define.flow.control.html">define.flow.control</a></span><span class="op">(</span> <span class="va">control.dir</span>, <span class="va">control.def.file</span>, <span class="va">asp</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># For speed and accuracy, the recommended approach is to clean the controls</span></span>
<span><span class="co"># using separate (universal) negative samples for both beads and cells.</span></span>
<span><span class="co"># In doing so, we select cells with matching autofluorescent background and</span></span>
<span><span class="co"># restrict the calculations to the brightest events.</span></span>
<span><span class="va">flow.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean.controls.html">clean.controls</a></span><span class="op">(</span> <span class="va">flow.control</span>, <span class="va">asp</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the clean spectra</span></span>
<span><span class="va">univ.neg.spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.fluorophore.spectra.html">get.fluorophore.spectra</a></span><span class="op">(</span></span>
<span>   <span class="va">flow.control</span>,</span>
<span>   <span class="va">asp</span>,</span>
<span>   use.clean.expr <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>   title <span class="op">=</span> <span class="st">"Universal Negative Cells"</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># By default AutoSpectral extracts autofluorescence as a spectrum.</span></span>
<span><span class="co"># This is comparable to "Autofluorescence as a Fluorescent Tag" in SpectroFlo</span></span>
<span><span class="co"># More on this later.</span></span>
<span><span class="co"># To remove this AF parameter for unmixing:</span></span>
<span><span class="va">no.af.spectra</span> <span class="op">&lt;-</span> <span class="va">univ.neg.spectra</span><span class="op">[</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span> <span class="va">univ.neg.spectra</span> <span class="op">)</span> <span class="op">==</span> <span class="st">"AF"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">## Unmixing</span></span>
<span><span class="co"># Set the location of the raw files to be unmixed.</span></span>
<span><span class="va">sample.dir</span> <span class="op">&lt;-</span> <span class="st">"./Raw samples"</span></span>
<span></span>
<span><span class="co"># Perform unmixing, here we will unmix all fcs files in the folder using </span></span>
<span><span class="co"># Weighted least squares (WLS or in Sony lingo, WLSM).</span></span>
<span><span class="fu"><a href="../reference/unmix.folder.html">unmix.folder</a></span><span class="op">(</span></span>
<span>   <span class="va">sample.dir</span>,</span>
<span>   <span class="va">no.af.spectra</span>,</span>
<span>   <span class="va">asp</span>,</span>
<span>   <span class="va">flow.control</span>,</span>
<span>   method <span class="op">=</span> <span class="st">"WLS"</span> </span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oliver Burton, Adrian Liston.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
