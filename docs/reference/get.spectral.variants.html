<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get Spectral Variations for Fluorophores — get.spectral.variants • AutoSpectral</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Spectral Variations for Fluorophores — get.spectral.variants"><meta name="description" content="This function cycles through all the fluorophores defined in control.def.file,
identifying variations in spectral profiles. It does this by performing SOM
clustering on the positive events in the cleaned control data. The output is
saved as an .rds file, and figures summarizing the variation are saved, if
desired. Note that the .rds file contains all the needed information for
downstream processing (per-cell unmixing), so you can just load that using
the readRDS function) rather than re-running this process."><meta property="og:description" content="This function cycles through all the fluorophores defined in control.def.file,
identifying variations in spectral profiles. It does this by performing SOM
clustering on the positive events in the cleaned control data. The output is
saved as an .rds file, and figures summarizing the variation are saved, if
desired. Note that the .rds file contains all the needed information for
downstream processing (per-cell unmixing), so you can just load that using
the readRDS function) rather than re-running this process."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AutoSpectral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/01_Full_AutoSpectral_Workflow.html">01 Full Workflow Example</a></li>
    <li><a class="dropdown-item" href="../articles/02_Control_File_example.html">02 Creating the control file</a></li>
    <li><a class="dropdown-item" href="../articles/03_Aurora_example.html">03 Aurora AutoSpectral Example</a></li>
    <li><a class="dropdown-item" href="../articles/04_ID7000_WLS_example.html">04 ID7000 WLS Example</a></li>
    <li><a class="dropdown-item" href="../articles/05_Preparing_Controls.html">05 Preparing Controls</a></li>
    <li><a class="dropdown-item" href="../articles/06_Gating.html">06 Gating</a></li>
    <li><a class="dropdown-item" href="../articles/07_Cleaning.html">07 Control clean-up</a></li>
    <li><a class="dropdown-item" href="../articles/08_Single_Cell_AutoFluorescence.html">08 Single Cell Autofluorescence</a></li>
    <li><a class="dropdown-item" href="../articles/09_Per_Cell_Optimization.html">09 Per Cell Optimization</a></li>
    <li><a class="dropdown-item" href="../articles/10_Reload_AutoSpectral.html">10 Re-running AutoSpectral</a></li>
    <li><a class="dropdown-item" href="../articles/11_Plotting.html">11 Plotting</a></li>
    <li><a class="dropdown-item" href="../articles/12_Speed_It_Up.html">12 Speed It Up (Why So Slow?)</a></li>
    <li><a class="dropdown-item" href="../articles/13_Updates_And_Issues.html">13 Updates and Issues</a></li>
    <li><a class="dropdown-item" href="../articles/14_Development.html">14 Development</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/DrCytometer/AutoSpectral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Spectral Variations for Fluorophores</h1>
      <small class="dont-index">Source: <a href="https://github.com/DrCytometer/AutoSpectral/blob/HEAD/R/get_spectral_variants.R" class="external-link"><code>R/get_spectral_variants.R</code></a></small>
      <div class="d-none name"><code>get.spectral.variants.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function cycles through all the fluorophores defined in <code>control.def.file</code>,
identifying variations in spectral profiles. It does this by performing SOM
clustering on the positive events in the cleaned control data. The output is
saved as an .rds file, and figures summarizing the variation are saved, if
desired. Note that the .rds file contains all the needed information for
downstream processing (per-cell unmixing), so you can just load that using
the <code>readRDS</code> function) rather than re-running this process.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get.spectral.variants</span><span class="op">(</span></span>
<span>  <span class="va">control.dir</span>,</span>
<span>  <span class="va">control.def.file</span>,</span>
<span>  <span class="va">asp</span>,</span>
<span>  <span class="va">spectra</span>,</span>
<span>  <span class="va">af.spectra</span>,</span>
<span>  n.cells <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  som.dim <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  figures <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output.dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  threads <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  refine <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  problem.quantile <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-control-dir">control.dir<a class="anchor" aria-label="anchor" href="#arg-control-dir"></a></dt>
<dd><p>File path to the single-stained control FCS files.</p></dd>


<dt id="arg-control-def-file">control.def.file<a class="anchor" aria-label="anchor" href="#arg-control-def-file"></a></dt>
<dd><p>CSV file defining the single-color control file names,
fluorophores they represent, marker names, peak channels, and gating requirements.</p></dd>


<dt id="arg-asp">asp<a class="anchor" aria-label="anchor" href="#arg-asp"></a></dt>
<dd><p>The AutoSpectral parameter list.
Prepare using <code>get.autospectral.param</code></p></dd>


<dt id="arg-spectra">spectra<a class="anchor" aria-label="anchor" href="#arg-spectra"></a></dt>
<dd><p>A matrix containing the spectral data. Fluorophores in rows,
detectors in columns.</p></dd>


<dt id="arg-af-spectra">af.spectra<a class="anchor" aria-label="anchor" href="#arg-af-spectra"></a></dt>
<dd><p>Spectral signatures of autofluorescences, normalized
between 0 and 1, with fluorophores in rows and detectors in columns. Prepare
using <code>get.af.spectra</code>.</p></dd>


<dt id="arg-n-cells">n.cells<a class="anchor" aria-label="anchor" href="#arg-n-cells"></a></dt>
<dd><p>Numeric, default <code>2000</code>. Number of cells to use for defining
the variation in spectra. Up to <code>n.cells</code> cells will be selected as positive
events in the peak channel for each fluorophore, above the 99.5th percentile
level in the unstained sample.</p></dd>


<dt id="arg-som-dim">som.dim<a class="anchor" aria-label="anchor" href="#arg-som-dim"></a></dt>
<dd><p>Numeric, default <code>10</code>. Number of x and y dimensions to use in
the SOM for clustering the spectral variation. The number of spectra returned
for each fluorophore will increase with the quadratic of <code>som.dim</code>, so for 10,
you will get up to 100 variants. Somewhere between 4 and 7 appears to be
sufficient, but with the pruning of variants implemented in
<code><a href="unmix.autospectral.html">unmix.autospectral()</a></code> in v1.0.0, this is less important.</p></dd>


<dt id="arg-figures">figures<a class="anchor" aria-label="anchor" href="#arg-figures"></a></dt>
<dd><p>Logical, controls whether the variation in spectra for each
fluorophore is plotted in <code>output.dir</code>. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-output-dir">output.dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>File path to whether the figures and .rds data file will be
saved. Default is <code>NULL</code>, in which case <code>asp$variant.dir</code> will be used.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>, in which case sequential processing
will be used. The new parallel processing should always be faster.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Set to <code>FALSE</code> to suppress messages.</p></dd>


<dt id="arg-threads">threads<a class="anchor" aria-label="anchor" href="#arg-threads"></a></dt>
<dd><p>Numeric, default is <code>NULL</code>, in which case <code>asp$worker.process.n</code>
will be used. <code>asp$worker.process.n</code> is set by default to be one less than the
available cores on the machine. Multi-threading is only used if <code>parallel</code> is
<code>TRUE</code>.</p></dd>


<dt id="arg-refine">refine<a class="anchor" aria-label="anchor" href="#arg-refine"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>. Controls whether to perform a second
round of variation measurement on "problem cells", which are those with the
highest spillover, as defined by <code>problem.quantile</code>. When <code>FALSE</code>,
behavior is identical to versions of AutoSpectral prior to 1.0.0. Setting to
<code>TRUE</code> may help reduce spillover spread and unmixing errors. Using <code>refine=TRUE</code>
does not impact subsequent unmixing calculation time in any significant way,
unlike the same setting in <code><a href="get.af.spectra.html">get.af.spectra()</a></code>.</p></dd>


<dt id="arg-problem-quantile">problem.quantile<a class="anchor" aria-label="anchor" href="#arg-problem-quantile"></a></dt>
<dd><p>Numeric, default <code>0.95</code>. The quantile for determining
which cells will be considered "problematic" after unmixing with per-cell AF
extraction. Cells in the <code>problem.quantile</code> or above with respect to total
signal in the fluorophore (non-AF) channels after per-cell AF extraction will
be used to determine additional autofluorescence spectra, using a second round
of clustering and modulation of the previously selected autofluroescence
spectra. A value of <code>0.95</code> means the top 5% of cells, those farthest from zero,
will be selected for further investigation.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Ignored. Previously used for deprecated arguments such as
<code>pos.quantile</code> and <code>sim.threshold</code>, which are now fixed internally and no
longer user-settable.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector with the indexes of events inside the initial gate.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oliver Burton, Adrian Liston.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

