# AutoSpectral

**Version 0.9.1**

Welcome to the Development branch of AutoSpectral.

This will always be a work-in-progress, and will not necessarily be
stable at any given point. At the moment, most of the changes taking
place relate to speeding things up or fixing any reported bugs.

To install the development version, run the code below in your
R/RStudio. This will overwrite any prior installation of AutoSpectral.
To restore the stable version of AutoSpectral, simply re-run the
`install_github()` command without the @dev bit.

``` r
# Install Bioconductor packages
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install(c("flowWorkspace", "flowCore", "PeacoQC", "FlowSOM"))

# You'll need devtools or remotes to install from GitHub.
# install.packages("devtools")
devtools::install_github("DrCytometer/AutoSpectral@dev")
```

# Introduction

AutoSpectral is AutoSpill updated for the spectral flow era.

The goal of AutoSpectral is to provide you with the best possible
spectral signatures of the fluorophores in your single-stained controls.
Whether or not these accurately model your fully stained samples will
depend on what you’ve chosen to use for the controls, how they were
prepared and other factors such as machine condition and any divergence
in handling between samples and controls.

More to the point, AutoSpectral is intended to make working with messy
cell-based controls as easy as compensation beads. This should give you
better accuracy and precision in your spectral definition and thus in
your unmixing.

AutoSpectral aims to provide reproducible unmixing, meaning that anyone
should be able to obtain reliably good (probably better) unmixing from
the same set of controls. The aim is to remove the human “fiddling”
part, which is slow and not always so scientific.

Plus, you can extract each cell’s individual autofluorescent background
in a manner specific to that cell, producing better unmixing with less
spread. Per-cell fluorescence spectral optimization can reduce unmixing
errors.

At the moment, the following cytometers are supported:

- Cytek Aurora (“aurora”)
- Cytek Northern Lights (“auroraNL”)
- Sony ID7000 (“id7000”)
- BD FACSDiscoverS8 (“s8”)
- BD FACSDiscoverA8 (“a8”)
- BD FACSymphony A5 SE (“a5se”)
- Agilent NovoCyte Opteon (“opteon”)
- Beckman Coulter CytoFLEX mosaic (“mosaic”)
- ThermoFisher Attune Xenith (“xenith”)

## Installation

[![Stable](https://img.shields.io/badge/stable-master-blue)](https://github.com/DrCytometer/AutoSpectral)
[![Dev](https://img.shields.io/badge/dev-branch-orange)](https://github.com/DrCytometer/AutoSpectral/tree/dev)

### Latest Stable Release

**Version 0.9.0**

To install the latest, hopefully stable version, install using
`devtools` or `remotes`. You will need to install the Bioconductor
packages separately.

``` r
# Install Bioconductor packages
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install(c("flowWorkspace", "flowCore", "PeacoQC", "FlowSOM"))

# You'll need devtools or remotes to install from GitHub.
# install.packages("devtools")
devtools::install_github("DrCytometer/AutoSpectral")
```

As of version 0.8.7, there is a Shiny helper tool to assist you in
setting up your AutoSpectral control files. This is an interactive html
app that opens in RStudio. Hopefully this makes things easier. It is
new, so again, probably not perfect. To try it, visit
[AutoSpectralHelper](https://github.com/DrCytometer/AutoSpectralHelper).
If you update AutoSpectral, I recommend downloading a new version of the
app to ensure compatibility.

To install a specific release, e.g., a previous one, use the version
number:

``` r
remotes::install_github("DrCytometer/AutoSpectral@v0.8.7")
```

### Dev branch

If you’re feeling adventurous or simply want early access to the latest
features, you can try the `dev` branch. At any given point, this may not
be working well.

AutoSpectral is open source. If you are interested in contributing,
please visit
[Development](https://drcytometer.github.io/AutoSpectral/articles/Development.html)
for suggestions of where help is needed most.

You can install the development version of AutoSpectral from
[GitHub](https://github.com/) with:

``` r
devtools::install_github("DrCytometer/AutoSpectral@dev")
```

## Bug fixes and known issues

AutoSpectral is pretty complex and newly released, so there will be
bugs. Sorry. Thanks to all of you providing feedback. Please submit any
and all issues either using the Issues page or via email at
colibri-cytometry at gmail.

To submit a bug report, go to
[Issues](https://github.com/DrCytometer/AutoSpectral/issues).

For more general problems, like not being clear on how to do things,
something doesn’t work well, or maybe you have an idea for something new
or better, visit the [Discussions
page](https://github.com/DrCytometer/AutoSpectral/discussions).

Since one of my recent updates broke things, I’ll be moving to using
tagged releases that should be easier to install if the latest version
has flaws. I’ve also set up a separate development branch, which will
get the updates first. Things probably should have been that way from
the start, but this is all new to me.

Please check the [help pages and
articles](https://drcytometer.github.io/AutoSpectral/) if you’re
struggling to understand how to do something. There’s a lot of info
there.

In particular, see the [Full
Workflow](https://drcytometer.github.io/AutoSpectral/articles/Full_AutoSpectral_Workflow.html).

Resolved issues, bug patches and improvements will be announced via the
NEWS and also tracked in the [Updates and
Issues](https://drcytometer.github.io/AutoSpectral/) article.

### Known shortcomings

- Gating. The automated gating is not great. See the [help
  page](https://drcytometer.github.io/AutoSpectral/articles/Gating.html)
  for tips. I’m working on an alternative.
- Please note that FCS 3.2 files from the S8 and A8 cytometers are not
  fully supported in flowCore. You may receive warnings, but things
  should still work.
- More stuff in progress will appear in the [Development
  article](https://drcytometer.github.io/AutoSpectral/articles/Development.html).
- This is my first R package.

If you want to use data from another cytometer and are wiling to provide
files for establishing the workflow, contact the author/maintainer. See
existing information, which may also assist you in setting up your
control file, in the [cytometer
database](https://docs.google.com/spreadsheets/d/1wj7QPkgpsuPNeVKyt-WWdBu5R48aZTgEbH8-_bpKeBY/edit?usp=sharing).

AutoSpectral relies on a database of information containing fluorophore
emission details. If your fluorophore is not detected automatically by
[`create.control.file()`](https://drcytometer.github.io/AutoSpectral/reference/create.control.file.md)
and you want to add it, visit the Google sheet for the [fluorophore
database](https://docs.google.com/spreadsheets/d/14j4lAQ6dkjDBKMborDv_MkSptyNBqZiBsq5jNNSCoiQ/edit?usp=sharing)
and add it there. New fluorophores will be incorporated into updates.

Similarly, there is a marker database to detect (and standardize) marker
names if they appear in the single-stained FCS control file names. Feel
free to add more markers or synonyms to the [marker
database](https://docs.google.com/spreadsheets/d/16FAinR_Nfnl00mpHvmQFJT_uJJY3VUWk29yAaQ7HHn8/edit?usp=sharing).

This work has received funding from the KU Leuven C1 program, the
European Union’s Horizon 2020 research and innovation programme under
grant agreement No 874707 (EXIMIOUS), Wellcome Investigator Award
222442/A/21/Z, and UKRI Proactive Vaccinology Award MR/Y004450/1
(IMMPROVE).

AutoSpectral is provided under an AGPL3 licence.

## Installation and Runtime

Installation via GitHub should take only a minute or so. It takes less
than that on a Dell i7 core laptop.

Occasionally, the help gets corrupted. Just re-install if that happens.
If you know why this happens, let me know.

Installation of `AutoSpectralRcpp` will take a couple of minutes because
the code needs to compile. You will also first have to install Rtools to
have a compiler, and that will take longer, probably 10 minutes or so.

For more details and benchmarking of specific functions with an example
40-color cell control data set, see the article on “Speed”.

## Go Faster

See the article on “Speed” for details on how to improve AutoSpectral’s
performance on your system.

## Updates and news

See the article “Updates and Issues” for more on this, or read the NEWS
with the latest release.

# Package index

## All functions

- [`calculate.condition.number()`](https://drcytometer.github.io/AutoSpectral/reference/calculate.condition.number.md)
  : Calculate Condition Number
- [`calculate.hotspot.matrix()`](https://drcytometer.github.io/AutoSpectral/reference/calculate.hotspot.matrix.md)
  : Calculate Hotspot Matrix
- [`calculate.weights()`](https://drcytometer.github.io/AutoSpectral/reference/calculate.weights.md)
  : Calculate Weights
- [`check.channels()`](https://drcytometer.github.io/AutoSpectral/reference/check.channels.md)
  : Check Channels
- [`check.control.file()`](https://drcytometer.github.io/AutoSpectral/reference/check.control.file.md)
  : Check Control File
- [`clean.controls()`](https://drcytometer.github.io/AutoSpectral/reference/clean.controls.md)
  : Clean Controls
- [`cosine.similarity.plot()`](https://drcytometer.github.io/AutoSpectral/reference/cosine.similarity.plot.md)
  : Cosine Similarity Plot
- [`cosine.similarity()`](https://drcytometer.github.io/AutoSpectral/reference/cosine.similarity.md)
  : Calculate Cosine Similarity
- [`create.biplot()`](https://drcytometer.github.io/AutoSpectral/reference/create.biplot.md)
  : Create Biplot
- [`create.control.file()`](https://drcytometer.github.io/AutoSpectral/reference/create.control.file.md)
  : Create Control File
- [`create.directory()`](https://drcytometer.github.io/AutoSpectral/reference/create.directory.md)
  : Create Directory
- [`create.heatmap()`](https://drcytometer.github.io/AutoSpectral/reference/create.heatmap.md)
  : Create Heatmap Plot
- [`create.parallel.lapply()`](https://drcytometer.github.io/AutoSpectral/reference/create.parallel.lapply.md)
  : Create Parallel Lapply
- [`define.flow.control()`](https://drcytometer.github.io/AutoSpectral/reference/define.flow.control.md)
  : Define Flow Control
- [`do.gate.af()`](https://drcytometer.github.io/AutoSpectral/reference/do.gate.af.md)
  : Perform Gating on Autofluorescence Parameters
- [`do.gate()`](https://drcytometer.github.io/AutoSpectral/reference/do.gate.md)
  : Do Gate
- [`do.peacoQC()`](https://drcytometer.github.io/AutoSpectral/reference/do.peacoQC.md)
  : Perform Quality Control on Flow Cytometry Data using PeacoQC
- [`.new_issue()`](https://drcytometer.github.io/AutoSpectral/reference/dot-new_issue.md)
  : New Issue
- [`downsample.control()`](https://drcytometer.github.io/AutoSpectral/reference/downsample.control.md)
  : Downsample Control Data
- [`fit.af.spline()`](https://drcytometer.github.io/AutoSpectral/reference/fit.af.spline.md)
  : Fit Spline to Autofluorescence Data
- [`fit.robust.linear.model()`](https://drcytometer.github.io/AutoSpectral/reference/fit.robust.linear.model.md)
  : Fit Robust Linear Model
- [`gate.af.identify.plot()`](https://drcytometer.github.io/AutoSpectral/reference/gate.af.identify.plot.md)
  : Plot Autofluorescence Identification Gate
- [`gate.af.sample.plot()`](https://drcytometer.github.io/AutoSpectral/reference/gate.af.sample.plot.md)
  : Plot Autofluorescence Gates on Samples
- [`gate.define.plot()`](https://drcytometer.github.io/AutoSpectral/reference/gate.define.plot.md)
  : Gate Definition Plot
- [`gate.sample.plot()`](https://drcytometer.github.io/AutoSpectral/reference/gate.sample.plot.md)
  : Plot Pre-defined Gate on Sample
- [`get.af.spectra()`](https://drcytometer.github.io/AutoSpectral/reference/get.af.spectra.md)
  : Get Autofluorescence Spectra
- [`get.autospectral.param.a5se()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.a5se.md)
  : Get AutoSpectral Parameters for the FACSymphony A5SE Cytometer
- [`get.autospectral.param.a8()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.a8.md)
  : Get Autospectral Parameters for DiscoverA8 Cytometer
- [`get.autospectral.param.aurora()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.aurora.md)
  : Get Autospectral Parameters for Aurora Cytometer
- [`get.autospectral.param.auroraNL()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.auroraNL.md)
  : Get Autospectral Parameters for the Aurora Northern Lights Cytometer
- [`get.autospectral.param.id7000()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.id7000.md)
  : Get Autospectral Parameters for ID7000 Cytometer
- [`get.autospectral.param.minimal()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.minimal.md)
  : Get Minimal Autospectral Parameters
- [`get.autospectral.param.mosaic()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.mosaic.md)
  : Get Autospectral Parameters for Mosaic Cytometer
- [`get.autospectral.param.opteon()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.opteon.md)
  : Get Autospectral Parameters for Opteon Cytometer
- [`get.autospectral.param()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.md)
  : Get AutoSpectral Parameters
- [`get.autospectral.param.s8()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.s8.md)
  : Get Autospectral Parameters for DiscoverS8 Cytometer
- [`get.autospectral.param.xenith()`](https://drcytometer.github.io/AutoSpectral/reference/get.autospectral.param.xenith.md)
  : Get Autospectral Parameters for Xenith Cytometer
- [`get.density.palette()`](https://drcytometer.github.io/AutoSpectral/reference/get.density.palette.md)
  : Get Density Color Palette
- [`get.fluor.variants()`](https://drcytometer.github.io/AutoSpectral/reference/get.fluor.variants.md)
  : Get Fluorophore Variants
- [`get.fluorophore.spectra()`](https://drcytometer.github.io/AutoSpectral/reference/get.fluorophore.spectra.md)
  : Get Fluorophore Spectra
- [`get.gated.flow.expression.data()`](https://drcytometer.github.io/AutoSpectral/reference/get.gated.flow.expression.data.md)
  : Get Gated Flow Expression Data
- [`get.spectral.variants()`](https://drcytometer.github.io/AutoSpectral/reference/get.spectral.variants.md)
  : Get Spectral Variations for Fluorophores
- [`get.ungated.flow.expression.data()`](https://drcytometer.github.io/AutoSpectral/reference/get.ungated.flow.expression.data.md)
  : Get Ungated Flow Expression Data
- [`get.universal.negative()`](https://drcytometer.github.io/AutoSpectral/reference/get.universal.negative.md)
  : Get Universal Negative Control
- [`match.fluorophores()`](https://drcytometer.github.io/AutoSpectral/reference/match.fluorophores.md)
  : Match Fluorophores
- [`match.markers()`](https://drcytometer.github.io/AutoSpectral/reference/match.markers.md)
  : Match Markers
- [`parallel.backend()`](https://drcytometer.github.io/AutoSpectral/reference/parallel.backend.md)
  : Parallel Backend
- [`read.bd.spectra()`](https://drcytometer.github.io/AutoSpectral/reference/read.bd.spectra.md)
  : Extract Spectra From BD FCS File
- [`read.channel()`](https://drcytometer.github.io/AutoSpectral/reference/read.channel.md)
  : Read Channel Information
- [`read.scatter.parameter()`](https://drcytometer.github.io/AutoSpectral/reference/read.scatter.parameter.md)
  : Read Scatter Parameters
- [`read.spectra()`](https://drcytometer.github.io/AutoSpectral/reference/read.spectra.md)
  : Read In Saved Spectra
- [`read.spectroflo.expt()`](https://drcytometer.github.io/AutoSpectral/reference/read.spectroflo.expt.md)
  : Extract Spectra From SpectroFlo Expt File
- [`reload.flow.control()`](https://drcytometer.github.io/AutoSpectral/reference/reload.flow.control.md)
  : Reload Flow Control Information
- [`remove.af()`](https://drcytometer.github.io/AutoSpectral/reference/remove.af.md)
  : Remove Autofluorescence Contamination
- [`run.af.removal()`](https://drcytometer.github.io/AutoSpectral/reference/run.af.removal.md)
  : Run Autofluorescence Removal
- [`run.downsample()`](https://drcytometer.github.io/AutoSpectral/reference/run.downsample.md)
  : Run Downsample
- [`run.peacoQC()`](https://drcytometer.github.io/AutoSpectral/reference/run.peacoQC.md)
  : Run PeacoQC
- [`run.trim.events()`](https://drcytometer.github.io/AutoSpectral/reference/run.trim.events.md)
  : Run Trim Events
- [`run.universal.negative()`](https://drcytometer.github.io/AutoSpectral/reference/run.universal.negative.md)
  : Run Universal Negative
- [`sample.fcs.file()`](https://drcytometer.github.io/AutoSpectral/reference/sample.fcs.file.md)
  : Sample FCS File
- [`save.unmixing.matrix()`](https://drcytometer.github.io/AutoSpectral/reference/save.unmixing.matrix.md)
  : Save Unmixing Matrix
- [`scatter.match.plot()`](https://drcytometer.github.io/AutoSpectral/reference/scatter.match.plot.md)
  : Plot Scatter-Matching of Universal Negative
- [`spectral.heatmap()`](https://drcytometer.github.io/AutoSpectral/reference/spectral.heatmap.md)
  : Spectral Heatmap
- [`spectral.ribbon.plot()`](https://drcytometer.github.io/AutoSpectral/reference/spectral.ribbon.plot.md)
  : Spectral Ribbon Plot
- [`spectral.trace()`](https://drcytometer.github.io/AutoSpectral/reference/spectral.trace.md)
  : Plot Fluorophore Spectra Traces
- [`spectral.variant.plot()`](https://drcytometer.github.io/AutoSpectral/reference/spectral.variant.plot.md)
  : Spectral Variant Plot
- [`trim.extreme.events()`](https://drcytometer.github.io/AutoSpectral/reference/trim.extreme.events.md)
  : Trim Extreme Events
- [`unmix.autospectral()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.autospectral.md)
  : Unmix AutoSpectral
- [`unmix.fcs()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.fcs.md)
  : Unmix FCS Data
- [`unmix.folder()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.folder.md)
  : Unmix All FCS Files in a Directory
- [`unmix.ols.fast()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.ols.fast.md)
  : Unmix OLS Fast
- [`unmix.ols()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.ols.md)
  : Unmix OLS
- [`unmix.poisson()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.poisson.md)
  : Unmix Using Poisson Regression
- [`unmix.wls.fast()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.wls.fast.md)
  : Unmix WLS Fast
- [`unmix.wls()`](https://drcytometer.github.io/AutoSpectral/reference/unmix.wls.md)
  : Unmix Using Weighted Least Squares
- [`validate.control.file()`](https://drcytometer.github.io/AutoSpectral/reference/validate.control.file.md)
  : Validate Control File

# Articles

### All vignettes

- [01 Full Workflow
  Example](https://drcytometer.github.io/AutoSpectral/articles/01_Full_AutoSpectral_Workflow.md):
- [02 Creating the control
  file](https://drcytometer.github.io/AutoSpectral/articles/02_Control_File_example.md):
- [03 Aurora AutoSpectral
  Example](https://drcytometer.github.io/AutoSpectral/articles/03_Aurora_example.md):
- [04
  Gating](https://drcytometer.github.io/AutoSpectral/articles/04_Gating.md):
- [05 Control
  clean-up](https://drcytometer.github.io/AutoSpectral/articles/05_Cleaning.md):
- [06 Single Cell
  Autofluorescence](https://drcytometer.github.io/AutoSpectral/articles/06_Single_Cell_AutoFluorescence.md):
- [07 Per Cell
  Optimization](https://drcytometer.github.io/AutoSpectral/articles/07_Per_Cell_Optimization.md):
- [08 Re-running
  AutoSpectral](https://drcytometer.github.io/AutoSpectral/articles/08_Reload_AutoSpectral.md):
- [09
  Plotting](https://drcytometer.github.io/AutoSpectral/articles/09_Plotting.md):
- [10
  Development](https://drcytometer.github.io/AutoSpectral/articles/10_Development.md):
- [11 Speed It Up (Why So
  Slow?)](https://drcytometer.github.io/AutoSpectral/articles/11_Speed_It_Up.md):
- [12 Updates and
  Issues](https://drcytometer.github.io/AutoSpectral/articles/12_Updates_And_Issues.md):
- [13 ID7000 WLS
  Example](https://drcytometer.github.io/AutoSpectral/articles/13_ID7000_WLS_example.md):
