<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Clean Controls — clean.controls • AutoSpectral</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Clean Controls — clean.controls"><meta name="description" content="A four-part function to clean single-color controls in order to extract
fluorophore signatures. Any part can be run independently:
Stage 1: PeacoQC to eliminate flow artefacts. Not required in most cases.
Stage 2: Trimming to eliminate extreme events. Not recommended for most
use cases.
Stage 3: Autofluorescence noise removal using PCA unmixing on matching
unstained (cells only).
Stage 4: Brightest event selection from positive, universal negative
from matching negative, and downsampling to speed up RLM spectra optimization.

"><meta property="og:description" content="A four-part function to clean single-color controls in order to extract
fluorophore signatures. Any part can be run independently:
Stage 1: PeacoQC to eliminate flow artefacts. Not required in most cases.
Stage 2: Trimming to eliminate extreme events. Not recommended for most
use cases.
Stage 3: Autofluorescence noise removal using PCA unmixing on matching
unstained (cells only).
Stage 4: Brightest event selection from positive, universal negative
from matching negative, and downsampling to speed up RLM spectra optimization.

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AutoSpectral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Aurora_example.html">Aurora AutoSpectral Example</a></li>
    <li><a class="dropdown-item" href="../articles/Cleaning.html">Control clean-up</a></li>
    <li><a class="dropdown-item" href="../articles/Control_File_example.html">Creating the control file</a></li>
    <li><a class="dropdown-item" href="../articles/Development.html">Development</a></li>
    <li><a class="dropdown-item" href="../articles/Full_AutoSpectral_Workflow.html">Full Workflow Example</a></li>
    <li><a class="dropdown-item" href="../articles/Gating.html">Gating</a></li>
    <li><a class="dropdown-item" href="../articles/Per_Cell_Optimization.html">Per Cell Optimization</a></li>
    <li><a class="dropdown-item" href="../articles/Plotting.html">Plotting</a></li>
    <li><a class="dropdown-item" href="../articles/Reload_AutoSpectral.html">Re-running AutoSpectral</a></li>
    <li><a class="dropdown-item" href="../articles/Single_Cell_AutoFluorescence.html">Single Cell Autofluorescence</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/DrCytometer/AutoSpectral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Clean Controls</h1>
      <small class="dont-index">Source: <a href="https://github.com/DrCytometer/AutoSpectral/blob/HEAD/R/clean_controls.R" class="external-link"><code>R/clean_controls.R</code></a></small>
      <div class="d-none name"><code>clean.controls.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A four-part function to clean single-color controls in order to extract
fluorophore signatures. Any part can be run independently:</p><ul><li><p><strong>Stage 1</strong>: PeacoQC to eliminate flow artefacts. Not required in most cases.</p></li>
<li><p><strong>Stage 2</strong>: Trimming to eliminate extreme events. Not recommended for most
use cases.</p></li>
<li><p><strong>Stage 3</strong>: Autofluorescence noise removal using PCA unmixing on matching
unstained (cells only).</p></li>
<li><p><strong>Stage 4</strong>: Brightest event selection from positive, universal negative
from matching negative, and downsampling to speed up RLM spectra optimization.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clean.controls</span><span class="op">(</span></span>
<span>  <span class="va">flow.control</span>,</span>
<span>  <span class="va">asp</span>,</span>
<span>  time.clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trim.factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  af.remove <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  universal.negative <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  downsample <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  negative.n <span class="op">=</span> <span class="va">asp</span><span class="op">$</span><span class="va">negative.n</span>,</span>
<span>  positive.n <span class="op">=</span> <span class="va">asp</span><span class="op">$</span><span class="va">positive.n</span>,</span>
<span>  scatter.match <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scrub <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  intermediate.figures <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main.figures <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  threads <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-flow-control">flow.control<a class="anchor" aria-label="anchor" href="#arg-flow-control"></a></dt>
<dd><p>A list prepared using <code>define.flow.control</code>, containing
the data and essential information about the cytometer and data structure.</p></dd>


<dt id="arg-asp">asp<a class="anchor" aria-label="anchor" href="#arg-asp"></a></dt>
<dd><p>The AutoSpectral parameter list, prepared using
<code>get.autospectral.param</code>.</p></dd>


<dt id="arg-time-clean">time.clean<a class="anchor" aria-label="anchor" href="#arg-time-clean"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>. Whether to run PeacoQC to
remove time-based inconsistencies in the controls.</p></dd>


<dt id="arg-trim">trim<a class="anchor" aria-label="anchor" href="#arg-trim"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>. Whether to remove extreme events
(positive and negative) from controls.</p></dd>


<dt id="arg-trim-factor">trim.factor<a class="anchor" aria-label="anchor" href="#arg-trim-factor"></a></dt>
<dd><p>Numeric. Default is <code>asp$rlm.trim.factor</code>. Required if
<code>trim = TRUE</code>.</p></dd>


<dt id="arg-af-remove">af.remove<a class="anchor" aria-label="anchor" href="#arg-af-remove"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Whether to remove intrusive
autofluorescence contamination from cell controls using PCA-based
identification and gating. Requires universal negatives to be defined in the
control file and in <code>flow.control</code>.</p></dd>


<dt id="arg-universal-negative">universal.negative<a class="anchor" aria-label="anchor" href="#arg-universal-negative"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Whether to use a
universal negative sample as the negative for spectral extraction. Requires
universal negatives to be defined in the control file and in <code>flow.control</code>.</p></dd>


<dt id="arg-downsample">downsample<a class="anchor" aria-label="anchor" href="#arg-downsample"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Whether to reduce cell and bead
control events to speed up processing.</p></dd>


<dt id="arg-negative-n">negative.n<a class="anchor" aria-label="anchor" href="#arg-negative-n"></a></dt>
<dd><p>Integer. Number of events to include in the downsampled
negative population. Default is <code>asp$negative.n</code>.</p></dd>


<dt id="arg-positive-n">positive.n<a class="anchor" aria-label="anchor" href="#arg-positive-n"></a></dt>
<dd><p>Integer. Number of events to include in the downsampled
positive population. Default is <code>asp$positive.n</code>.</p></dd>


<dt id="arg-scatter-match">scatter.match<a class="anchor" aria-label="anchor" href="#arg-scatter-match"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Whether to select negative
events based on scatter profiles matching the positive events. Defines a
region of FSC and SSC based on the distribution of selected positive events.</p></dd>


<dt id="arg-scrub">scrub<a class="anchor" aria-label="anchor" href="#arg-scrub"></a></dt>
<dd><p>Logical, if <code>TRUE</code> allows for re-cleaning of already cleaned
data, provided there are clean data in <code>flow.control</code>.</p></dd>


<dt id="arg-intermediate-figures">intermediate.figures<a class="anchor" aria-label="anchor" href="#arg-intermediate-figures"></a></dt>
<dd><p>Logical, if <code>TRUE</code> returns additional figures to
show the inner workings of the cleaning, including definition of low-AF cell
gates on the PCA-unmixed unstained and spectral ribbon plots of the AF
exclusion from the unstained. Default is <code>FALSE</code> to speed up processing.</p></dd>


<dt id="arg-main-figures">main.figures<a class="anchor" aria-label="anchor" href="#arg-main-figures"></a></dt>
<dd><p>Logical, if <code>TRUE</code> creates the main figures to show the
impact of intrusive autofluorescent event removal and scatter-matching for
the negatives.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>, in which case parallel processing
will not be used. Parallel processing will likely be faster when many small
files are read in. If the data is larger, parallel processing may not
accelerate the process much.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Set to <code>FALSE</code> to suppress messages.</p></dd>


<dt id="arg-threads">threads<a class="anchor" aria-label="anchor" href="#arg-threads"></a></dt>
<dd><p>Numeric, number of threads to use for parallel processing.
Default is <code>NULL</code> which will revert to <code>asp$worker.process.n</code> if
<code>parallel=TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a modified <code>flow.control</code> with the original data intact. New, cleaned
data and corresponding factors are stored in new slots.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oliver Burton, Adrian Liston.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

